<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="789px" height="1046px" viewBox="-0.5 -0.5 789 1046" content="&lt;mxfile modified=&quot;2019-09-16T13:59:15.115Z&quot; host=&quot;www.draw.io&quot; agent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot; etag=&quot;Vn3nkdrNxQ44sAZGHS5_&quot; version=&quot;11.2.8&quot; type=&quot;device&quot; pages=&quot;1&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;13e1069c-82ec-6db2-03f1-153e76fe0fe0&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="332" y="255" width="259" height="790" rx="38.85" ry="38.85" fill="#ffffff" stroke="#000000" pointer-events="none"/><ellipse cx="425" cy="60" rx="10" ry="10" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 425 160 L 425 273.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 278.88 L 421.5 271.88 L 425 273.63 L 428.5 271.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="360" y="110" width="130" height="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(361.5,122.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="127" height="25" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 127px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Set timer <b>compare</b> value at HWP</div></div></foreignObject><text x="64" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Set timer &lt;b&gt;compare&lt;/b&gt; value at HWP</text></switch></g><path d="M 425 70 L 425 103.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 108.88 L 421.5 101.88 L 425 103.63 L 428.5 101.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 430 L 425 468.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 473.88 L 421.5 466.88 L 425 468.63 L 428.5 466.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="365" y="370" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(366.5,374.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="117" height="51" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 117px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Get elapsed tick count from the timer (should ideally be 0 if synced perfectly)</div></div></foreignObject><text x="59" y="32" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 425 520 L 425 543.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 548.88 L 421.5 541.88 L 425 543.63 L 428.5 541.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="365" y="475" width="120" height="45" rx="6.75" ry="6.75" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(366.5,484.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="117" height="25" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 117px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Wrap error to within [-HWP/2, +HWP/2]</div></div></foreignObject><text x="59" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Wrap error to within [-HWP/2, +HWP/2]</text></switch></g><g transform="translate(365.5,2.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="113" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>PWM DRIVER ONLY</b></div></div></foreignObject><text x="57" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">&lt;b&gt;PWM DRIVER ONLY&lt;/b&gt;</text></switch></g><path d="M 110 250 L 110 390 Q 110 400 120 400 L 358.63 400" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 363.88 400 L 356.88 403.5 L 358.63 400 L 356.88 396.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1.5,232.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="224" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><b>zeroCrossing interrupt from ADC driver</b></div></div></foreignObject><text x="112" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">&lt;b&gt;zeroCrossing interrupt from ADC driver&lt;/b&gt;</text></switch></g><rect x="365" y="280" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(366.5,290.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="117" height="38" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 117px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">IDLE STATE, wait for ADC zero crossing interrupt</div></div></foreignObject><text x="59" y="25" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">IDLE STATE, wait for ADC zero crossing interrupt</text></switch></g><g transform="translate(191.5,372.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="104" height="25" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Registered callback <br />in the PWM driver</div></div></foreignObject><text x="52" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Registered callback &lt;br&gt;in the PWM driver</text></switch></g><g transform="translate(609.5,30.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="163" height="51" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">HWP = Half-wave period <br />of the input (mains) supply<br />in clock ticks (i.e. 10 us in <br />terms of the timer's clock ticks)</div></div></foreignObject><text x="82" y="32" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 425 590 L 425 613.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 618.88 L 421.5 611.88 L 425 613.63 L 428.5 611.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="365" y="550" width="120" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(379.5,564.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="91" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 92px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Accumulate error</div></div></foreignObject><text x="46" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Accumulate error</text></switch></g><path d="M 425 800 L 425 823.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 828.88 L 421.5 821.88 L 425 823.63 L 428.5 821.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="365" y="730" width="120" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(366.5,739.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="117" height="51" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 117px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Multiply the instantaneous error by Kp, accumulated error by Ki</div></div></foreignObject><text x="59" y="32" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 425 700 L 425 723.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 728.88 L 421.5 721.88 L 425 723.63 L 428.5 721.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 425 620 L 480 660 L 425 700 L 370 660 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(371.5,647.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="107" height="25" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 107px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">10 iterations passed?</div></div></foreignObject><text x="54" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">10 iterations passed?</text></switch></g><path d="M 480 660 L 520 660 L 520 310 L 491.37 310" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 486.12 310 L 493.12 306.5 L 491.37 310 L 493.12 313.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(486.5,642.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="18" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">NO</div></div></foreignObject><text x="9" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">NO</text></switch></g><g transform="translate(432.5,704.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="24" height="11" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 24px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">YES</div></div></foreignObject><text x="12" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">YES</text></switch></g><path d="M 425 890 L 425 910 L 424 910 L 424 913.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 424 918.88 L 420.5 911.88 L 424 913.63 L 427.5 911.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="365" y="830" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(366.5,834.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="117" height="51" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 117px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Add this calculated value to the timer <b>compare </b>value as a correction</div></div></foreignObject><text x="59" y="32" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 484 950 L 550 950 L 550 310 L 491.37 310" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 486.12 310 L 493.12 306.5 L 491.37 310 L 493.12 313.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="364" y="920" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(365.5,924.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="117" height="51" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 117px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Set new timer compare value and reset timer, and enable timer interrupt</div></div></foreignObject><text x="59" y="32" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>